{"version":3,"sources":["../../src/helpers/getProposalData.ts"],"sourcesContent":["import dayjs from 'dayjs';\n\nimport { HashZero } from './checkHash';\nimport {\n  BasicProposal,\n  ProposalData,\n  ProposalStructOutput,\n  VMProposalStructOutput,\n  VotingMachineProposalState,\n} from './types';\n\nexport function getVotingMachineProposalState(proposal: BasicProposal) {\n  const now = dayjs().unix();\n  if (proposal.votingMachineData.startTime === 0) {\n    return VotingMachineProposalState.NotCreated;\n  } else if (now <= proposal.votingMachineData.endTime) {\n    return VotingMachineProposalState.Active;\n  } else if (proposal.votingMachineData.votingClosedAndSentBlockNumber === 0) {\n    return VotingMachineProposalState.Finished;\n  } else {\n    return VotingMachineProposalState.SentToGovernance;\n  }\n}\n\nexport function formatVotingMachineData(\n  id: number,\n  votingMachineData: Readonly<VMProposalStructOutput>,\n) {\n  return {\n    id: id,\n    forVotes: votingMachineData.proposalData.forVotes.toString(),\n    againstVotes: votingMachineData.proposalData.againstVotes.toString(),\n    startTime: votingMachineData.proposalData.startTime,\n    endTime: votingMachineData.proposalData.endTime,\n    votingClosedAndSentBlockNumber: Number(\n      votingMachineData.proposalData.votingClosedAndSentBlockNumber,\n    ),\n    votingClosedAndSentTimestamp:\n      votingMachineData.proposalData.votingClosedAndSentTimestamp,\n    l1BlockHash: votingMachineData?.voteConfig.l1ProposalBlockHash || HashZero,\n    strategy: votingMachineData.strategy,\n    sentToGovernance: votingMachineData.proposalData.sentToGovernance,\n    createdBlock: Number(votingMachineData.proposalData.creationBlockNumber),\n    votedInfo: {\n      support: votingMachineData.votedInfo.support,\n      votingPower: votingMachineData.votedInfo.votingPower.toString(),\n    },\n    votingAssets: votingMachineData.votingAssets,\n    hasRequiredRoots: votingMachineData.hasRequiredRoots,\n  };\n}\n\nexport function updateVotingMachineData(\n  proposals: ProposalData[],\n  votingMachineDataHelperData: Readonly<VMProposalStructOutput[]>,\n  ids: number[],\n) {\n  const proposalsData: BasicProposal[] = [];\n\n  ids.forEach((id) => {\n    const govData = proposals.find((proposal) => proposal?.id === id);\n    if (govData) {\n      const votingMachineData =\n        votingMachineDataHelperData.find(\n          (proposal) => Number(proposal.proposalData.id) === govData.id,\n        ) || votingMachineDataHelperData[0];\n\n      const proposalData = {\n        id: govData.id,\n        votingDuration:\n          +votingMachineData?.voteConfig.votingDuration ||\n          govData.votingDuration,\n        creationTime: govData.creationTime,\n        accessLevel: govData.accessLevel,\n        basicState: govData.basicState,\n        queuingTime: govData.queuingTime,\n        ipfsHash: govData.ipfsHash,\n        initialPayloads: govData.initialPayloads,\n        snapshotBlockHash: govData.snapshotBlockHash,\n        creator: govData.creator,\n        canceledAt: govData.canceledAt,\n        votingActivationTime: govData.votingActivationTime,\n        votingChainId: govData.votingChainId,\n        votingMachineData: formatVotingMachineData(\n          govData.id,\n          votingMachineData,\n        ),\n        prerender: govData.prerender,\n      };\n\n      proposalsData.push(proposalData);\n    }\n  });\n\n  return proposalsData;\n}\n\nexport function getDetailedProposalsData(\n  govCoreDataHelperData: Readonly<ProposalStructOutput[]>,\n  votingMachineDataHelperData: Readonly<VMProposalStructOutput[]>,\n  ids: number[],\n  prerender?: boolean,\n): BasicProposal[] {\n  const proposalsData: BasicProposal[] = [];\n\n  for (let i = 0; i < ids.length; i++) {\n    const govData = govCoreDataHelperData[i];\n\n    const votingMachineData =\n      votingMachineDataHelperData.find(\n        (proposal) => Number(proposal.proposalData.id) === Number(govData.id),\n      ) || votingMachineDataHelperData[i];\n\n    const proposalData = {\n      id: Number(govData.id),\n      votingDuration:\n        +votingMachineData?.voteConfig.votingDuration ||\n        +govData.proposalData.votingDuration,\n      creationTime: +govData.proposalData.creationTime,\n      accessLevel: +govData.proposalData.accessLevel,\n      basicState: +govData.proposalData.state,\n      queuingTime: +govData.proposalData.queuingTime,\n      ipfsHash: govData.proposalData.ipfsHash,\n      initialPayloads: govData.proposalData.payloads.map((payload) => {\n        return {\n          id: payload.payloadId,\n          chainId: Number(payload.chain),\n          payloadsController: payload.payloadsController,\n        };\n      }),\n      snapshotBlockHash: govData.proposalData.snapshotBlockHash,\n      creator: govData.proposalData.creator,\n      canceledAt: govData.proposalData.cancelTimestamp,\n      votingActivationTime: govData.proposalData.votingActivationTime,\n      votingChainId: Number(govData.votingChainId),\n      votingMachineData: formatVotingMachineData(\n        Number(govData.id),\n        votingMachineData,\n      ),\n      prerender: !!prerender,\n    };\n\n    proposalsData.push(proposalData);\n  }\n\n  return proposalsData;\n}\n"],"mappings":"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","names":[]}