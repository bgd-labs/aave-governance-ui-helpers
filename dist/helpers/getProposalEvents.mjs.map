{"version":3,"sources":["../../src/helpers/getProposalEvents.ts"],"sourcesContent":["import { Hex } from 'viem';\n\nimport { normalizeBN } from './bignumber';\nimport { votingMachineContract } from './contracts';\nimport { getEventsBySteps } from './eventsHelpres';\nimport { InitEventWithChainId } from './types';\n\nasync function getVoteEvents({\n  contractAddress,\n  client,\n  startBlock,\n  endBlock,\n  chainId,\n}: InitEventWithChainId) {\n  const votingMachine = votingMachineContract({\n    contractAddress,\n    client,\n  });\n\n  const events = await client.getContractEvents({\n    abi: votingMachine.abi,\n    eventName: 'VoteEmitted',\n    fromBlock: BigInt(startBlock),\n    toBlock: BigInt(endBlock),\n  });\n\n  return events\n    .sort((a, b) => Number(b.blockNumber) - Number(a.blockNumber))\n    .map((event) => ({\n      proposalId: Number(event.args.proposalId),\n      address: (event.args.voter || '').toString() as Hex,\n      support: event.args.support || false,\n      votingPower: normalizeBN(\n        (event.args.votingPower || '').toString(),\n        18,\n      ).toNumber(),\n      transactionHash: event.transactionHash as Hex,\n      blockNumber: Number(event.blockNumber),\n      chainId,\n    }));\n}\n\nexport async function getVoters({\n  contractAddress,\n  client,\n  endBlock,\n  startBlock,\n  blockLimit,\n  chainId,\n}: InitEventWithChainId & { blockLimit: number }) {\n  const callbackFunc = async (\n    startBlockNumber: number,\n    endBlockNumber: number,\n  ) => {\n    return await getVoteEvents({\n      contractAddress,\n      client,\n      startBlock: startBlockNumber,\n      endBlock: endBlockNumber,\n      chainId,\n    });\n  };\n\n  return getEventsBySteps(startBlock, endBlock, blockLimit, callbackFunc);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAEA,SAAS,mBAAmB;AAC5B,SAAS,6BAA6B;AACtC,SAAS,wBAAwB;AAGjC,SAAe,cAAc,IAMJ;AAAA,6CANI;AAAA,IAC3B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,GAAyB;AACvB,UAAM,gBAAgB,sBAAsB;AAAA,MAC1C;AAAA,MACA;AAAA,IACF,CAAC;AAED,UAAM,SAAS,MAAM,OAAO,kBAAkB;AAAA,MAC5C,KAAK,cAAc;AAAA,MACnB,WAAW;AAAA,MACX,WAAW,OAAO,UAAU;AAAA,MAC5B,SAAS,OAAO,QAAQ;AAAA,IAC1B,CAAC;AAED,WAAO,OACJ,KAAK,CAAC,GAAG,MAAM,OAAO,EAAE,WAAW,IAAI,OAAO,EAAE,WAAW,CAAC,EAC5D,IAAI,CAAC,WAAW;AAAA,MACf,YAAY,OAAO,MAAM,KAAK,UAAU;AAAA,MACxC,UAAU,MAAM,KAAK,SAAS,IAAI,SAAS;AAAA,MAC3C,SAAS,MAAM,KAAK,WAAW;AAAA,MAC/B,aAAa;AAAA,SACV,MAAM,KAAK,eAAe,IAAI,SAAS;AAAA,QACxC;AAAA,MACF,EAAE,SAAS;AAAA,MACX,iBAAiB,MAAM;AAAA,MACvB,aAAa,OAAO,MAAM,WAAW;AAAA,MACrC;AAAA,IACF,EAAE;AAAA,EACN;AAAA;AAEA,SAAsB,UAAU,IAOkB;AAAA,6CAPlB;AAAA,IAC9B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,GAAkD;AAChD,UAAM,eAAe,CACnB,kBACA,mBACG;AACH,aAAO,MAAM,cAAc;AAAA,QACzB;AAAA,QACA;AAAA,QACA,YAAY;AAAA,QACZ,UAAU;AAAA,QACV;AAAA,MACF,CAAC;AAAA,IACH;AAEA,WAAO,iBAAiB,YAAY,UAAU,YAAY,YAAY;AAAA,EACxE;AAAA;","names":[]}