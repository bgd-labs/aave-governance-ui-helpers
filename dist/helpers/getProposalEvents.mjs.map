{"version":3,"sources":["../../src/helpers/getProposalEvents.ts"],"sourcesContent":["import { Hex, PublicClient } from 'viem';\n\nimport { normalizeBN } from './bignumber';\nimport { votingMachineContract } from './contracts';\nimport { getEventsBySteps } from './eventsHelpres';\n\nasync function getVoteEvents(\n  contractAddress: Hex,\n  client: PublicClient,\n  startBlock: number,\n  endBlock: number,\n  chainId: number,\n) {\n  const votingMachine = votingMachineContract(contractAddress, client);\n\n  const events = await client.getContractEvents({\n    abi: votingMachine.abi,\n    eventName: 'VoteEmitted',\n    fromBlock: BigInt(startBlock),\n    toBlock: BigInt(endBlock),\n  });\n\n  return events\n    .sort((a, b) => Number(b.blockNumber) - Number(a.blockNumber))\n    .map((event) => ({\n      proposalId: Number(event.args.proposalId),\n      address: (event.args.voter || '').toString() as Hex,\n      support: event.args.support || false,\n      votingPower: normalizeBN(\n        (event.args.votingPower || '').toString(),\n        18,\n      ).toNumber(),\n      transactionHash: event.transactionHash as Hex,\n      blockNumber: Number(event.blockNumber),\n      chainId,\n    }));\n}\n\nexport async function getVoters(\n  contractAddress: Hex,\n  client: PublicClient,\n  endBlock: number,\n  startBlock: number,\n  blockLimit: number,\n  chainId: number,\n) {\n  const callbackFunc = async (\n    startBlockNumber: number,\n    endBlockNumber: number,\n  ) => {\n    return await getVoteEvents(\n      contractAddress,\n      client,\n      startBlockNumber,\n      endBlockNumber,\n      chainId,\n    );\n  };\n\n  return getEventsBySteps(startBlock, endBlock, blockLimit, callbackFunc);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAEA,SAAS,mBAAmB;AAC5B,SAAS,6BAA6B;AACtC,SAAS,wBAAwB;AAEjC,SAAe,cACb,iBACA,QACA,YACA,UACA,SACA;AAAA;AACA,UAAM,gBAAgB,sBAAsB,iBAAiB,MAAM;AAEnE,UAAM,SAAS,MAAM,OAAO,kBAAkB;AAAA,MAC5C,KAAK,cAAc;AAAA,MACnB,WAAW;AAAA,MACX,WAAW,OAAO,UAAU;AAAA,MAC5B,SAAS,OAAO,QAAQ;AAAA,IAC1B,CAAC;AAED,WAAO,OACJ,KAAK,CAAC,GAAG,MAAM,OAAO,EAAE,WAAW,IAAI,OAAO,EAAE,WAAW,CAAC,EAC5D,IAAI,CAAC,WAAW;AAAA,MACf,YAAY,OAAO,MAAM,KAAK,UAAU;AAAA,MACxC,UAAU,MAAM,KAAK,SAAS,IAAI,SAAS;AAAA,MAC3C,SAAS,MAAM,KAAK,WAAW;AAAA,MAC/B,aAAa;AAAA,SACV,MAAM,KAAK,eAAe,IAAI,SAAS;AAAA,QACxC;AAAA,MACF,EAAE,SAAS;AAAA,MACX,iBAAiB,MAAM;AAAA,MACvB,aAAa,OAAO,MAAM,WAAW;AAAA,MACrC;AAAA,IACF,EAAE;AAAA,EACN;AAAA;AAEA,SAAsB,UACpB,iBACA,QACA,UACA,YACA,YACA,SACA;AAAA;AACA,UAAM,eAAe,CACnB,kBACA,mBACG;AACH,aAAO,MAAM;AAAA,QACX;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,IACF;AAEA,WAAO,iBAAiB,YAAY,UAAU,YAAY,YAAY;AAAA,EACxE;AAAA;","names":[]}