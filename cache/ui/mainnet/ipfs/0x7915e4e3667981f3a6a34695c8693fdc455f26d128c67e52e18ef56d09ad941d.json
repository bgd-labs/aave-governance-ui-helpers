{
  "ipfsHash": "QmWVKQQ2vfd4XEU1xdmpDVMmSA28XzAPR1PQyXicL9RqEC",
  "description": "\n## Simple Summary\n\nUpgrade the Aave v3 Protocol across all networks from v3.3 to v3.4.\n\n## Motivation\n\nThe motivation behind this proposal is to upgrade the Aave instances to version 3.4, which includes several improvements most notably:\n\n- The “standardisation” of the custom a/v GHO on Ethereum Core, into the usual a/v Token model for any other asset, including all migration steps required on the protocol layer, not to affect users.\n- Multi-call support.\n- Introduction of the configurable Position Manager for users, to optionally allow switching emode or collateral enable/disable on behalf of the user.\n- Removal of the “unbacked” logic from the protocol.\n- Changes of different variables to immutables, given their constant nature.\n- Migration to Errors, instead of error codes.\n- Flash loan fee simplification.\n\nAnd extensive list of features and Changelog can be found [HERE](https://github.com/aave-dao/aave-v3-origin/blob/59a2a02be96c824a67ab65f0c465e6db2b034d81/docs/3.4/Aave-v3.4-features.md)\n\n## Specification\n\nThe upgrade payload updates the implementations of the `PoolConfigurator`, `Pool`,`PoolDataProvider`, `AToken` & `VariableDebtToken` on all networks.\n\nOn Aave V3 Ethereum, the proposal performs some additional actions, to account for aligning `vGHO` from being a custom implementation to the standard implementation.\n\n_It is important to note that stakers of `stkAAVE` will no longer receive a discount on `vGHO` after the upgrade._\nDue to technical limitations, the pending discount will be lost upon upgrade time. The stkAAVE discount only manifests whenever a user interacts with the vGHO (by either repaying or borrowing).\nTo reduce the impact of this loss, `Dolce vita` will iterate the users and call `vGHO.rebalanceUserDiscountPercent(user)` for every user that receives a discount within `< 24h` before proposal execution.\nThis will reduce the loss to less then 1 day of discount accrual.\n\nBy upgrading the implementation of `vGHO` & `aGHO` the existing `aGHO facilitator` will be removed and the new `aGHO` will follow the same pattern as the current `prime GHO facilitator`, namely the whole `GHO capacity` will be pre-minted to `aGHO` instead of minting on demand. Therefore it is expected that on the upgrade we will see:\n\n- ~177M GHO being minted to the new facilitator\n- ~177M GHO being transferred to `aGHO`\n- ~177M GHO being burned from `aGHO`\n- ~23M GHO being minted to the new facilitator\n- ~23M GHO being deposited into `aGHO`\n\nThe exact numbers, will depend on the current state of the system and the amount of vGHO that is currently in circulation at the time of execution.\n\nFor a more detailed breakdown of the steps performed during the upgrades please check [here](https://github.com/bgd-labs/protocol-v3.4-upgrade?tab=readme-ov-file#general-upgrade-sequence-via-upgradepayload)\n\n## Security procedures\n\n- The upgrade was extensively unit tested and fuzzed.\n- Certora adapted its formal properties to ensure the upgrade's correctness.\n\nIn addition 4 audits by Independent Auditors were conducted.\n\n- [Stermi](https://github.com/aave-dao/aave-v3-origin/blob/74412e2b6e0b1973fac6837b6a488f8eaaeac4b1/audits/2025-06-11_Stermi_Aave-v3.4_Report.md)\n- [Certora](https://github.com/aave-dao/aave-v3-origin/blob/74412e2b6e0b1973fac6837b6a488f8eaaeac4b1/audits/2025-06-11_Certora_Aave-v3.4_Report.pdf)\n- [Enigma](https://github.com/aave-dao/aave-v3-origin/blob/74412e2b6e0b1973fac6837b6a488f8eaaeac4b1/audits/2025-05-13_Enigma_Aave-v3.4.pdf)\n- [Blackthorn](https://github.com/aave-dao/aave-v3-origin/blob/74412e2b6e0b1973fac6837b6a488f8eaaeac4b1/audits/2025-06-12_Blackthorn-v3.4_Report.pdf)\n\n## References\n\n- Implementation: [AaveV3EthereumCore](https://github.com/bgd-labs/protocol-v3.4-upgrade/blob/main/src/UpgradePayloadMainnet.sol), [AllOtherInstances](https://github.com/bgd-labs/protocol-v3.4-upgrade/blob/main/src/UpgradePayload.sol)\n- Tests: [AaveV3EthereumCore](https://github.com/bgd-labs/protocol-v3.4-upgrade/blob/main/test/MainnetCore.t.sol), [AllOtherInstances](https://github.com/bgd-labs/protocol-v3.4-upgrade/blob/main/test/UpgradeTest.t.sol)\n- Upgrade diff: [v3.3 - v3.4](https://github.com/aave-dao/aave-v3-origin/pull/129)\n- Onchain Diffs: [Per network diffs](https://github.com/bgd-labs/protocol-v3.4-upgrade/tree/main/diffs/code)\n- [Snapshot](https://snapshot.box/#/s:aavedao.eth/proposal/0xbbdd44ff07184dc17b9215414f5bb747a48c19e699c7505df35a7e1ca54e9da6)\n- [Discussion](https://governance.aave.com/t/arfc-bgd-aave-v3-4/21572/20)\n\n## Copyright\n\nCopyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).\n",
  "title": "Upgrade Aave instances to v3.4",
  "author": "BGD Labs @bgdlabs",
  "discussions": "https://governance.aave.com/t/arfc-bgd-aave-v3-4/21572/21",
  "snapshot": "https://snapshot.box/#/s:aavedao.eth/proposal/0xbbdd44ff07184dc17b9215414f5bb747a48c19e699c7505df35a7e1ca54e9da6",
  "originalIpfsHash": "0x7915e4e3667981f3a6a34695c8693fdc455f26d128c67e52e18ef56d09ad941d"
}