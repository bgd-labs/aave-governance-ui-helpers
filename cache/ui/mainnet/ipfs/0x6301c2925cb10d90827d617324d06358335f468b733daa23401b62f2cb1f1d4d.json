{
  "ipfsHash": "QmV18dPYtFLAdR6SRWxHvqx4qef6BspdXPMttQPy1yARPA",
  "description": "\n## Simple Summary\n\nProposal to update a.DI with the new Shuffle mechanism, included into the v1.1 release presented [HERE](https://governance.aave.com/t/bgd-a-di-aave-delivery-infrastructure-v1-1/17838).\n\n## Motivation\n\na.DI v1 has one constraint, that even if not major, limits the scalability of the system: whenever a new underlying bridge provider is added to the set of a communication path, each message on that path will be passed through all the bridges, no matter if the consensus required on the recipient side is lower.\nFor example, currently all messages Ethereum → Polygon are sent via CCIP, LayerZero, Hyperlane, and the Polygon native bridge, even if the consensus required on the Polygon side is 3-of-4. This means that even if consensus was reached already before the slowest bridge delivers the message (Polygon native in this case), the cost incurred is of the whole set of 4 bridges, not only 3.\n\na.DI v1.1 (and more specifically its Shuffling feature) introduces a mechanism for, whenever a message needs to be sent, the system choosing pseudo-randomly a sub-set of all the available bridges for that specific path (e.g. Ethereum → Polygon) with optimal bandwidth size,\nand only forwards the message via those bridges.\n\nBy doing this:\n\n- Cost is reduced on all those configurations with optimal bandwidth < bandwidth.\n- Any bottleneck to add new underlying bridge providers is removed, as increasing bandwidth doesn’t really have any effect on the optimal bandwidth of the path.\n- Security-wise, the pseudo-random nature of the shuffling mechanism improves the system, in the line of other rotation-based systems like validators-selection in PoS blockchains.\n\n## Specification\n\nThis proposal upgrades a.DI on every supported network with the new implementation containing the Shuffle mechanism; afterwards, it configures the new parameters required.\n\nThe upgrade adds a new `_optimalBandwidthByChain` mapping on CrossChainForwarder that will store the optimal bandwidth for every supported chain. This will be used to determine how many adapters will be used to pass a message to a destination network\n\nThe OptimalBandwidth used to update a.DI will be:\n\n| Origin Network | Ethereum | Polygon | Avalanche | Arbitrum | Optimism | Base | Gnosis | Metis | Binance | Scroll |\n| -------------- | -------- | ------- | --------- | -------- | -------- | ---- | ------ | ----- | ------- | ------ |\n| Ethereum       | -        | 4       | 2         | 1        | 1        | 1    | 2      | 1     | 2       | 1      |\n| Polygon        | 3        | -       | -         | -        | -        | -    | -      | -     | -       | -      |\n| Avalanche      | 2        | -       | -         | -        | -        | -    | -      | -     | -       | -      |\n| Arbitrum       | -        | -       | -         | -        | -        | -    | -      | -     | -       | -      |\n| Optimism       | -        | -       | -         | -        | -        | -    | -      | -     | -       | -      |\n| Base           | -        | -       | -         | -        | -        | -    | -      | -     | -       | -      |\n| Gnosis         | -        | -       | -         | -        | -        | -    | -      | -     | -       | -      |\n| Metis          | -        | -       | -         | -        | -        | -    | -      | -     | -       | -      |\n| Binance        | -        | -       | -         | -        | -        | -    | -      | -     | -       | -      |\n| Scroll         | -        | -       | -         | -        | -        | -    | -      | -     | -       | -      |\n\nThe method used to initialize a.DI with the new bandwidth configurations is:\n\n```solidity\nfunction initializeRevision(\n  OptimalBandwidthByChain[] memory optimalBandwidthByChain\n) external reinitializer(3) {\n  _updateOptimalBandwidthByChain(optimalBandwidthByChain);\n}\n```\n\nThe new CrossChainController implementations for every supported network are the following:\n\n| Network   | New CCC implementation with Shuffle support                                                                                      |\n| --------- | -------------------------------------------------------------------------------------------------------------------------------- |\n| Ethereum  | [0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d](https://etherscan.io/address/0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d)            |\n| Polygon   | [0x191f2bd27f1ce4318f9a0c6b82688c66cd7ad3ba](https://polygonscan.com/address/0x191f2bd27f1ce4318f9a0c6b82688c66cd7ad3ba)         |\n| Avalanche | [0x23f5150ace7382c7160a2192c3f9f77444f420d9](https://snowscan.xyz/address/0x23f5150ace7382c7160a2192c3f9f77444f420d9)            |\n| Arbitrum  | [0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d](https://arbiscan.io/address/0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d)             |\n| Optimism  | [0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d](https://optimistic.etherscan.io/address/0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d) |\n| Base      | [0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d](https://basescan.org/address/0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d)            |\n| Gnosis    | [0x88e9f8e208ba5ae72b56861d63cbf70fd2320f5c](https://gnosisscan.io/address/0x88e9f8e208ba5ae72b56861d63cbf70fd2320f5c)           |\n| Metis     | [0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d](https://explorer.metis.io/address/0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d)       |\n| Binance   | [0xda81fb369942e43d4797e79f2c4cbef9fe58b90a](https://bscscan.com/address/0xda81fb369942e43d4797e79f2c4cbef9fe58b90a)             |\n| Scroll    | [0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d](https://scrollscan.com/address/0x92f4736b72d131d836b3e4d4c3c23fe53150ce4d)          |\n\n## Security\n\nCertora audit report on the Shuffle update can be found [here](https://github.com/bgd-labs/aave-delivery-infrastructure/blob/3c842f4d0a484ea8f574ab31c4a50026e16691ec/security/certora/reports/aDI-Shuffle.pdf)\n\n## References\n\n- Implementation: CrossChainController Shuffle update payloads [implementation](https://github.com/bgd-labs/adi-deploy/blob/e33318258fedc3317949bb9f8c7c57966a3e3197/src/ccc_payloads/shuffle/ShuffleCCCUpdatePayload.sol)\n- Tests: CrossChainController Shuffle update [tests](https://github.com/bgd-labs/adi-deploy/blob/e33318258fedc3317949bb9f8c7c57966a3e3197/tests/ccc/shuffle/ShufflePayloadTests.t.sol)\n- Diffs: CrossChainController implementation address change [diffs](https://github.com/bgd-labs/adi-deploy/blob/e33318258fedc3317949bb9f8c7c57966a3e3197/diffs)\n- [Discussion](https://governance.aave.com/t/bgd-technical-maintenance-proposals/15274/39)\n\n## Copyright\n\nCopyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).\n",
  "title": "ADI Shuffle Update",
  "author": "BGD Labs @bgdlabs",
  "discussions": "https://governance.aave.com/t/bgd-a-di-aave-delivery-infrastructure-v1-1/17838",
  "originalIpfsHash": "0x6301c2925cb10d90827d617324d06358335f468b733daa23401b62f2cb1f1d4d"
}